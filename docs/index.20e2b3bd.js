const e=e=>document.createElement(e),t=e=>document.querySelector(e),o=e=>e.classList,n=(e,t,o)=>e.setAttribute(t,o),r=(e,t)=>e.getAttribute(t),l=(e,t,o)=>e.addEventListener(t,o),i=(e,t,o)=>e.style.setProperty(t,o),a=(e,t)=>window.localStorage.setItem(e,t),c="MAIN_MENU",s="LEVEL_SELECTION_MENU",d="COLOR_SETTINGS",h="GAME",u="RESET_MENU",m="WINNER_MENU",p="LAZY_EYE_SETTINGS_MENU",b="LEFT_EYE_SETTINGS_MENU",f="RIGHT_EYE_SETTINGS_MENU",g="light",v="dark",E="lazy",y="cell",w="flipped_cell",k="board",C="menu",$="menu-title",S="menu-title-item",_="status-line-button",T="background-color",N="border-bottom",L="outline",M="outline-offset",O="color",I={location:c,board:[],moves:[],solution:[],pattern:null,theme:g,leftEyeColor:"red",rightEyeColor:"blue"},A={...I};let R=[];function j(e,t){Object.assign(A,e);const o=Object.keys(e);t&&R.forEach((({properties:e,callback:t})=>{(e.some((e=>o.includes(e)))||0===e.length)&&t(A)}))}function x(e){j(e,!0)}function U(){return A}function z(e,t,o){const n=Object.keys(A);e.forEach((e=>{if(!n.includes(e))throw new Error(`${e} is not key in the state.`)})),R.push({properties:e,callback:t,name:o})}function B(e){R=R.filter((t=>t.name!==e))}const G="row_index",H="column_index",Y="5px",q="2px",D="7357f676-a003-4524-a931-1316d9efb156",J=()=>U().leftEyeColor,P=()=>U().rightEyeColor,W={[g]:{[C]:[[T,"white"]],[$]:[[O,"black"],[N,"1vh solid black"]],[S]:[[O,"black"],[L,`${Y} solid black`],[M,`-${Y}`]],[y]:[[T,"white"],[L,`${Y} solid black`],[M,`-${Y}`]],[w]:[[T,"black"]],[k]:[[T,"white"]],[_]:[[L,`${q} solid black`],[M,`-${q}`]]},[v]:{[C]:[[T,"black"]],[$]:[[O,"white"],[N,"1vh solid white"]],[S]:[[O,"white"],[L,`${Y} solid white`],[M,`-${Y}`]],[y]:[[T,"black"],[L,`${Y} solid white`],[M,`-${Y}`]],[w]:[[T,"white"]],[k]:[[T,"black"]],[_]:[[O,"white"],[L,`${q} solid white`],[M,`-${q}`]]},[E]:{[C]:[[T,"black"]],[$]:[[O,J],[N,()=>`1vh solid ${P()}`]],[S]:[[O,J],[L,()=>`${q} solid ${P()}`],[M,`-${q}`]],[y]:[[T,J]],[w]:[[T,P]],[k]:[[T,"black"]],[_]:[[O,J],[L,()=>`${q} solid ${P()}`],[M,`-${q}`]]}},F=(e,t)=>W[t]&&W[t][e]?W[t][e]:[],V=(e,t)=>{Object.values(W).forEach((t=>{Object.values(t).forEach((t=>{for(let o=0;o<t.length;o+=1)e.style[t[o][0]]=""}))})),t.forEach((([t,o])=>{const n="function"==typeof o?o():o;i(e,t,n)}))},X="whole_cross",Z="random",K={[X]:(e,t)=>(o,n)=>{const r=[];for(let t=0;t<e;t+=1)r.push([t,n]);for(let e=0;e<t;e+=1)r.some((([t,n])=>t===o&&n===e))||r.push([o,e]);return r},small_cross:(e,t)=>(o,n)=>[[0,0],[-1,0],[1,0],[0,-1],[0,1]].filter((r=>r[0]+o<e&&r[1]+n<t)).filter((e=>e[0]+o>=0&&e[1]+n>=0)).map((e=>[e[0]+o,e[1]+n])),inverted_cross:(e,t)=>(o,n)=>[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]].filter((r=>r[0]+o<e&&r[1]+n<t)).filter((e=>e[0]+o>=0&&e[1]+n>=0)).map((e=>[e[0]+o,e[1]+n])),[Z]:(e,t)=>{const o=Object.keys(K).filter((e=>e!==Z)),n=o[Math.floor(Math.random()*o.length)];return K[n](e,t)}},Q=(e,t,o,n)=>{const r=K[o](n.length,n[0].length);const l=n.map((e=>e.map((e=>e))));return r(e,t).forEach((([e,t])=>{l[e][t]=!n[e][t]})),l},ee=(e,t,{board:o,pattern:n,moves:r})=>({board:Q(e,t,n,o),moves:[...r,[e,t]]}),te=({board:e,pattern:t,moves:o})=>{if(0===o.length)return{board:e,moves:o};const n=[...o],[r,l]=n.pop();return{board:Q(r,l,t,e),moves:n}},oe=({board:e,pattern:t,moves:o})=>{let n=[...o],r=e.map((e=>e.map((e=>e))));for(;n.length>0;){const e=te({board:r,pattern:t,moves:n});r=e.board,n=e.moves}return{board:r,moves:n}},ne=(e,t,o,n)=>({rows:e,columns:t,stepsToSolve:o,pattern:n}),re=ne(4,4,5,X),le=ne(5,5,10,X),ie=ne(7,7,20,X),ae=(e,t,o)=>{const n=e=>Math.floor(Math.random()*e);return[...Array(e)].map((()=>[n(t),n(o)]))},ce=e=>{const{board:t,solution:o,pattern:n}=(({rows:e,columns:t,stepsToSolve:o,pattern:n})=>{let r=[...Array(e)].map((()=>Array(t).fill(!0)));const l=ae(o,e,t);for(let e=0;e<l.length;e+=1){const[t,o]=l[e];r=Q(t,o,n,r)}return{board:r,solution:l,pattern:n}})({...e});x({solution:o,pattern:n,moves:[]}),j({board:t},!1)},se=e=>x({location:e}),de=e=>x({theme:e}),he=(e,{width:t,height:o,margin:n})=>{i(e,"width",t),i(e,"height",o),i(e,"margin",n)},ue=e=>{const t=e.length,o=window.innerWidth<window.innerHeight?"vw":"vh",n=Math.floor(90/t*.95);return{margin:.05*n+o,width:n+o,height:n+o}},me=({target:e})=>{const t=U(),o=parseInt(r(e,G),10),n=parseInt(r(e,H),10);var l,i;x({...ee(o,n,t)}),U().board.every((e=>e.every((e=>e))))&&(l=()=>se(m),i=500,window.setTimeout(l,i))},pe=(e,t)=>V(e,F(k,t)),be=(e,t,o)=>{V(e,F(t?y:w,o))},fe=()=>{B("board-theme-observer"),B("cell-board-observer");const t=U(),r=e("div");o(r).add("board"),pe(r,t.theme),z(["theme"],(({theme:e})=>pe(r,e)),"board-theme-observer");const{board:i}=U();for(let a=0;a<i.length;a+=1){const c=e("div");o(c).add("row");for(let r=0;r<i[a].length;r+=1){const s=e("div");o(s).add("cell"),n(s,G,a),n(s,H,r),l(s,"click",me),he(s,ue(i)),be(s,t.board[a][r],t.theme),z(["board"],(e=>be(s,e.board[a][r],e.theme)),"cell-board-observer"),c.appendChild(s)}r.appendChild(c)}return r},ge=()=>{var e;(e=".cell",document.querySelectorAll(e)).forEach((e=>{const{board:t}=U();he(e,ue(t))}))},ve={currentLocation:null,map:{}};function Ee(e,o){Object.assign(ve.map,o);z(["location"],(({location:e})=>{if(e!==ve.currentLocation){const o=t("#root");o.innerHTML="";let n=ve.map[e];n="function"==typeof n?n():n,o.appendChild(n),ve.currentLocation=e}})),x({location:e})}function ye(t){const n=e("div");return o(n).add("ui-menu"),t&&t.forEach((e=>n.appendChild(e))),V(n,F(C,U().theme)),z(["theme"],(({theme:e})=>{V(n,F(C,e))}),"menu-theme-observer"),n}function we(t,n){const r=e("button");return r.innerText=t,r.onclick=n,o(r).add("ui-menu-item"),V(r,F(S,U().theme)),z(["theme"],(({theme:e})=>{V(r,F(S,e))}),"menu-item-theme-observer"),r}function ke(t){const n=e("button");return n.innerText=t,n.disabled=!0,o(n).add("ui-menu-title"),V(n,F($,U().theme)),z(["theme"],(({theme:e})=>{V(n,F($,e))}),"menu-theme-observer"),n}const Ce=24,$e=e=>{const t=255/(Ce/2);return e<Ce/2?`rgb(${255-e*t},0,0)`:`rgb(0,0,${(e-Ce/2)*t})`},Se=(e,t)=>{const o=t/(Ce+1);let n=1;for(;e>o*n;)n+=1;return $e(n-1)};function _e(t){const n=e("canvas");o(n).add("color-picker");const r=n.getContext("2d"),i=n.width/(Ce+1);for(let e=0;e<=Ce;e+=1)r.fillStyle=$e(e),r.fillRect(e*i,0,i,n.height);return l(n,"click",(({clientX:e})=>{if(n){const{left:o,width:r}=n.getBoundingClientRect(),l=Se(e-o,r);t(l)}})),n}function Te(t){const n=e("canvas");return o(n).add("color-indicator"),z([],(e=>{if(n){const o=t(e),r=n.getContext("2d");r.fillStyle=o,r.fillRect(0,0,n.width,n.height)}})),n}function Ne(t,n){const r=e("button");return o(r).add("status-line-button"),r.innerHTML=t,r.onclick=n,V(r,F(_,U().theme)),r}const Le=()=>{const e=U();x({...te(e)})};function Me(){const t=e("div");return o(t).add("status-line"),t.appendChild(Ne("back",(()=>se(c)))),t.appendChild(Ne("undo",Le)),t.appendChild(Ne("reset",(()=>se(u)))),t}function Oe(){const t=e("div");return i(t,"height","100%"),t.appendChild(fe()),t.appendChild(Me()),t}function Ie(){const e=we("Continue",(()=>se(h)));return i(e,"display","none"),z(["pattern"],(({pattern:t})=>{i(e,"display",null===t?"none":"block")})),e}function Ae(){const e=ye();return e.appendChild(ke("Renverso")),e.appendChild(we("New game",(()=>se(s)))),e.appendChild(Ie()),e.appendChild(we("Color theme",(()=>se(d)))),e}const Re=()=>{const e=U();x({...oe(e)}),se(h)};const je=()=>{x({board:[],moves:[],solution:[],pattern:null,location:c})},xe=e=>"move"+(e.length>1?"s":"");function Ue(){const{moves:e}=U();return ye([ke(`Puzzle solved in ${e.length} ${xe(e)}!`),we("To main menu",je)])}const ze=e=>{ce(e),se(h)};window.onresize=()=>{ge()},window.onload=()=>{Ee(c,{[h]:()=>Oe(),[c]:Ae(),[u]:ye([ke("Do you want to reset level progress?"),we("Yes",(()=>Re())),we("No",(()=>se(h)))]),[m]:()=>Ue(),[d]:ye([ke("Select color theme"),we("Light",(()=>de(g))),we("Dark",(()=>de(v))),we("Lazy eye",(()=>se(p))),we("Back",(()=>se(c)))]),[s]:ye([ke("Select level"),we("Easy",(()=>ze(re))),we("Medium",(()=>ze(le))),we("Hard",(()=>ze(ie))),we("Back",(()=>se(c)))]),[p]:ye([ke("Lazy eye coloring settings"),we("Left eye color",(()=>se(b))),we("Right eye color",(()=>se(f))),we("Apply",(()=>de(E))),we("Back",(()=>se(d)))]),[b]:ye([ke("Left eye color"),Te((e=>e.leftEyeColor)),_e((e=>x({leftEyeColor:e}))),we("Back",(()=>se(p)))]),[f]:ye([ke("Right eye color"),Te((e=>e.rightEyeColor)),_e((e=>x({rightEyeColor:e}))),we("Back",(()=>se(p)))])});const e=(t=D,window.localStorage.getItem(t));var t;x(null!==e?{...JSON.parse(e)}:{theme:"light"});z(Object.keys(U()),(e=>a(D,JSON.stringify(e))))};